<!DOCTYPE html>
<html>
<head>
  <title>📲 Copy Paste by User (Realtime DB)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    input, textarea { width: 90%; font-size: 16px; margin: 10px 0; padding: 10px; }
    textarea { height: 150px; }
    button { padding: 10px 20px; font-size: 16px; }
    p { font-weight: bold; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

  <h2>🔒 Real-Time Copy-Paste by Session</h2>

  <input id="sessionId" placeholder="Enter Session ID (e.g. vishnu123)" />
  <button onclick="connect()">🔗 Connect</button>

  <textarea id="textData" placeholder="Type to sync..." disabled></textarea>
  <p id="status">⏳ Waiting for session ID...</p>

  <script>
    // Replace this with your real Firebase config
    const firebaseConfig = {
  apiKey: "AIzaSyCTLn4g2_i5xJ8kcheWF9HdBL6e2uBxdsE",
  databaseURL:'https://copypaste-7012d-default-rtdb.firebaseio.com',
  authDomain: "copypaste-7012d.firebaseapp.com",
  projectId: "copypaste-7012d",
  storageBucket: "copypaste-7012d.firebasestorage.app",
  messagingSenderId: "222988500391",
  appId: "1:222988500391:web:5e7b4a849d070c6dae8a82"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let ref = null;
    let debounce = null;

    function connect() {
      const sessionId = document.getElementById("sessionId").value.trim();
      const textarea = document.getElementById("textData");
      const status = document.getElementById("status");

      if (!sessionId) {
        alert("Please enter a session ID");
        return;
      }

      ref = db.ref("clipboard/" + sessionId);
      status.innerText = "✅ Connected to session: " + sessionId;
      textarea.disabled = false;

      // Listen for changes
      ref.on('value', snapshot => {
        const data = snapshot.val();
        if (data && data.text !== textarea.value) {
          textarea.value = data.text;
          status.innerText = "📥 Synced from session: " + sessionId;
        }
      });

      // Update on user input
      textarea.addEventListener('input', () => {
        clearTimeout(debounce);
        debounce = setTimeout(() => {
          ref.set({ text: textarea.value })
            .then(() => status.innerText = "✅ Sent to session: " + sessionId)
            .catch(err => alert("Error: " + err.message));
        }, 400);
      });
    }
  </script>

</body>
</html>
