<!DOCTYPE html>
<html>
<head>
  <title>📲 Auto-Copy Sync (Realtime DB)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    input, textarea { width: 90%; font-size: 16px; margin: 10px 0; padding: 10px; }
    textarea { height: 150px; }
    button { padding: 10px 20px; font-size: 16px; }
    p { font-weight: bold; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

  <h2>📋 Auto-Copy Between Devices (Realtime DB)</h2>

  <input id="sessionId" placeholder="Enter Session ID (same on both phones)" />
  <button onclick="connect()">🔗 Connect</button>

  <textarea id="textData" placeholder="Type to sync..." disabled></textarea>
  <p id="status">⏳ Waiting for session ID...</p>

  <script>
    // 🔧 Replace with your Firebase config:
    const firebaseConfig = {
  apiKey: "AIzaSyCTLn4g2_i5xJ8kcheWF9HdBL6e2uBxdsE",
  databaseURL:'https://copypaste-7012d-default-rtdb.firebaseio.com',
  authDomain: "copypaste-7012d.firebaseapp.com",
  projectId: "copypaste-7012d",
  storageBucket: "copypaste-7012d.firebasestorage.app",
  messagingSenderId: "222988500391",
  appId: "1:222988500391:web:5e7b4a849d070c6dae8a82"
};

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let ref = null;
    let debounce = null;
    let lastSent = ""; // To prevent echo syncing

    function connect() {
      const sessionId = document.getElementById("sessionId").value.trim();
      const textarea = document.getElementById("textData");
      const status = document.getElementById("status");

      if (!sessionId) {
        alert("Please enter a session ID");
        return;
      }

      ref = db.ref("clipboard/" + sessionId);
      status.innerText = "✅ Connected to session: " + sessionId;
      textarea.disabled = false;

      // Listen to real-time changes
      ref.on('value', snapshot => {
        const data = snapshot.val();
        if (data && data.text !== textarea.value) {
          textarea.value = data.text;
          status.innerText = "📥 Synced and copied to clipboard";

          // Avoid self-copy if user is sender
          if (data.text !== lastSent) {
            navigator.clipboard.writeText(data.text).then(() => {
              console.log("📋 Copied to clipboard");
            }).catch(err => {
              console.warn("⚠️ Clipboard copy failed:", err);
            });
          }
        }
      });

      // On typing, update Firebase
      textarea.addEventListener('input', () => {
        clearTimeout(debounce);
        debounce = setTimeout(() => {
          lastSent = textarea.value;
          ref.set({ text: textarea.value })
            .then(() => status.innerText = "✅ Sent to session: " + sessionId)
            .catch(err => alert("Error: " + err.message));
        }, 400);
      });
    }
  </script>

</body>
</html>
